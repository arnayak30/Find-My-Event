<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>FindMyEvent - The Simple Way to Organize and Find Events</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />
  <link href="assets/css/popup_view.css" rel="stylesheet">

  <!-- Favicons -->
  <link href="assets/imgs/fme-favicon.png" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Anyar - v2.1.0
  * Template URL: https://bootstrapmade.com/anyar-free-multipurpose-one-page-bootstrap-theme/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= --><header id="header" class="fixed-top ">
  <div class="container d-flex align-items-center">

    <h1 class="logo mr-auto"><a href="index.html#header" class="scrollto"><img src="assets/imgs/fme-logo.png"></a></h1>

    <nav class="nav-menu d-none d-lg-block">
      <ul>
        <li class="active"><a href="index.html#header">Home</a></li>
        <li><a href="index.html#get-started">How To</a></li>
        <li><a href="index.html#sign-up">Subscribe</a></li>
        <li><a href="index.html#about">About</a></li>
        <li><a href="index.html#contact">Contact</a></li>
        <li><a href="find-event.html" style="border-style: solid; border-color: #f6b024; padding-left: 10px; padding-right: 10px; border-radius: 7px">Find Event</a></li>
        <li><a href="create-event.html" style="border-style: solid; border-color: #f6b024; padding-left: 10px; padding-right: 10px; border-radius: 7px">Create Event</a></li>
      </ul>
    </nav><!-- .nav-menu -->

  </div>
</header><!-- End Header -->

<main id="main">

  <!-- ======= Breadcrumbs ======= --><section id="breadcrumbs" class="breadcrumbs" style="">
  <div class="container">

    <ol>
      <li>Event Listing</li>
    </ol>
    <h2>Create an Event in Your Community</h2>

  </div>
</section><!-- End Breadcrumbs -->


  <br/>
  <br/>
  <div class="row">
    <div id="map" style="width: 100%;height: 500px;justify-items: center; text-align: center; margin-left: 50px;margin-right: 50px; position: relative">
      <script src="https://unpkg.com/es6-promise@4.2.4/dist/es6-promise.auto.min.js"></script>
      <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
    </div>
  </div>
  <br>
  <br>
  <div class="form1" style="margin-left: 5%;">
    <a>Required fields are indicated <a style="color: red">*</a></a><br/><br/><br/>
    <a><a style="color: red">*</a>Event Type: </a><br/><label for="userInput1"></label><select id="userInput1" name="eventType" style="width: 30%"><br/>
    <option value="Select">Select</option>
    <option value="Volunteer">Volunteer</option>
    <option value="Protest">Protest</option>
    <option value="Food Drive">Food Drive</option>
    <option value="Blood Drive">Blood Drive</option>
    <option value="Clothing Drive">Clothing Drive</option>
    <option value="Other">Other</option>
  </select><br/><br/>
    <a><a style="color: red">*</a>Event Name: </a><br/><input type="text" id="userInput2" name="event name"><br/>
    <a><a style="color: red">*</a>Organization Name: </a><br/><input type="text" id="userInput3" name="event name"><br/>
    <a><a style="color: red">*</a>Location: </a><br/><input type="text" id="userInput4" name="location"><br/><br/>
    <a><a style="color: red">*</a>Date of Event (mm/dd/yyyy): </a><br/><input type="text" id="userInput9" name="location"><br/>
    <a><a style="color: red">*</a>Event Start Time (ex. 11:30am): </a><br/><input type="text" id="userInput10" name="location"><br/>
    <a><a style="color: red">*</a>Event End Time (ex. 2:00pm): </a><br/><input type="text" id="userInput11" name="location"><br/>
    <a><a style="color: red">*</a>Description: </a><br/><textarea id="userInput5" name="description" rows="4" style="width: 100%"> </textarea><br/>
    <a><a style="color: red">*</a>Contact Information (Phone number, email, etc.): </a><br/><textarea id="userInput6" name="contact" rows="2" style="width: 100%"> </textarea><br/>
    <a>Website URL (Optional): </a><br/><input type="text" id="userInput7" name="event name"><br/>
    <a>Attendees Needed (Optional): </a><br/><input type="text" id="userInput8" name="attendees"><br/>
    <input type="submit" value="Create Event" onclick="setMap()">
  </div>
  <br/>
  <br/>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>



  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyCE4wODrP7h7tKm80YaF3SAij6A23ZKBvE",
      authDomain: "findmyevent.firebaseapp.com",
      databaseURL: "https://findmyevent.firebaseio.com",
      projectId: "findmyevent",
      storageBucket: "findmyevent.appspot.com",
      messagingSenderId: "334832030161",
      appId: "1:334832030161:web:69e9aaf2fabc483a5050f0",
      measurementId: "G-QRH6G9XMS6"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  </script>
  <style>
    #marker {
      background-image: url("pin.png");
      background-size: cover;
      width: 39px;
      height: 39px;
      border-radius: 100%;

    }

    .mapboxgl-popup {
      width: 200%;
      height: 200%;
      font: 16px 'Georgia', Arial, Helvetica, sans-serif;
    }
  </style>
  <!--<div style="margin-left: 10%; color: blue;font-weight: bold">
    <a id="lbl1">Event Type: </a><br/>
    <a id="lbl2">Event Name: </a><br/>
    <a id="lbl3">Organization Name: </a><br/>
    <a id="lbl4">Location: </a><br/>
    <a id="lbl5">Description: </a><br/>
    <a id="lbl6">Contact Information: </a><br/>
    <a id="lbl7">Website URL: </a><br/>
    <a id="lbl8">Attendees Required: </a><br/>
  </div>-->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyCE4wODrP7h7tKm80YaF3SAij6A23ZKBvE",
      authDomain: "findmyevent.firebaseapp.com",
      databaseURL: "https://findmyevent.firebaseio.com",
      projectId: "findmyevent",
      storageBucket: "findmyevent.appspot.com",
      messagingSenderId: "334832030161",
      appId: "1:334832030161:web:69e9aaf2fabc483a5050f0",
      measurementId: "G-QRH6G9XMS6"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  </script>
  <style>
    @media only screen and (min-width: 600px) {
      @media only screen and (min-width: 600px) {
        /* For tablets: */
        .col-s-1 {width: 8.33%;}
        .col-s-2 {width: 16.66%;}
        .col-s-3 {width: 25%;}
        .col-s-4 {width: 33.33%;}
        .col-s-5 {width: 41.66%;}
        .col-s-6 {width: 50%;}
        .col-s-7 {width: 58.33%;}
        .col-s-8 {width: 66.66%;}
        .col-s-9 {width: 75%;}
        .col-s-10 {width: 83.33%;}
        .col-s-11 {width: 91.66%;}
        .col-s-12 {width: 100%;}
      }
      @media only screen and (min-width: 768px) {
        /* For desktop: */
        .col-1 {width: 8.33%;}
        .col-2 {width: 16.66%;}
        .col-3 {width: 25%;}
        .col-4 {width: 33.33%;}
        .col-5 {width: 41.66%;}
        .col-6 {width: 50%;}
        .col-7 {width: 58.33%;}
        .col-8 {width: 66.66%;}
        .col-9 {width: 75%;}
        .col-10 {width: 83.33%;}
        .col-11 {width: 91.66%;}
        .col-12 {width: 100%;}
      }
    #marker {
      background-image: url("pin.png");
      background-size: cover;
      width: 39px;
      height: 39px;
      border-radius: 100%;

    }

    .mapboxgl-popup {
      width: 200%;
      height: 200%;
      font: 16px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
  </style>
  <!--<div style="margin-left: 10%; color: blue;font-weight: bold">
    <a id="lbl1">Event Type: </a><br/>
    <a id="lbl2">Event Name: </a><br/>
    <a id="lbl3">Organization Name: </a><br/>
    <a id="lbl4">Location: </a><br/>
    <a id="lbl5">Description: </a><br/>
    <a id="lbl6">Contact Information: </a><br/>
    <a id="lbl7">Website URL: </a><br/>
    <a id="lbl8">Attendees Required: </a><br/>
  </div>-->

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibmF5YWsxMzI5IiwiYSI6ImNrYmkxZGZ4eTA3OWYycnBkY3Q0czNhNGcifQ.gptv7vDeenxsCwBZ3-qXbw';
    /*var place = prompt("Set a marker at: city, state");
    var l = "";
    createEventObject(place);*/
    var l = "";
    //Map strictly focuses on the US.
    var eventType = "";
    var eventName = "";
    var orgName = "";
    var loc = "";
    var desc = "";
    var contactInfo = "";
    var webLink = "";
    var attendees = "";
    var start = false;

    var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/nayak1329/ckbkci8ei02ei1ijzqesxvof5',
      center: [-89.3985, 40.6331],
      zoom: 2
    });
    //createEventObject(true);
    readTextFile();

    function setMap(){
      eventType = document.getElementById("userInput1").value;
      eventName = document.getElementById("userInput2").value;
      orgName = document.getElementById("userInput3").value;
      loc = document.getElementById("userInput4").value;
      desc = document.getElementById("userInput5").value;
      contactInfo = document.getElementById("userInput6").value;
      webLink = document.getElementById("userInput7").value;
      attendees = document.getElementById("userInput8").value;


      if (eventType=="Select"||eventName==""||loc==""||contactInfo==""||orgName==""||desc==""||contactInfo==""){
        alert("There is Missing Information that is Required")
      }
      else{
        location.href = "#breadcrumbs";
        document.getElementById("userInput1").value = "Select";
        for (i=2; i<=8; i++){
          var txt = "userInput" + i.toString();
          document.getElementById(txt).value = "";
        }
        //addEventToFirebase(eventType, eventName, orgName, loc, desc, contactInfo, webLink, attendees);
        createEventObject(false);
        displayMap(false);
      }

    }

    function readTextFile() {
      var rawFile = new XMLHttpRequest();
      rawFile.open("GET", "./events.txt");
      rawFile.onreadystatechange = function () {
        if(rawFile.readyState === 4 && (rawFile.status === 200 || rawFile.status === 0)){
          // var allText = rawFile.responseText;
          // alert(allText)
          eventsfilecontent = rawFile.responseText;
          createEventMarkers(eventsfilecontent)
        }
      }
      rawFile.send()

    }

    function createEventMarkers(text) {
      var eventsInfo = []
      while (text.length > 0) {
        var eventInfo = text.substring(0, text.indexOf("\n"));
        eventsInfo.push(eventInfo);
        text = text.substring(text.indexOf("\n")+1);
      }

      for(var i = 0; i < eventsInfo.length; i++){
        var data = eventsInfo[i];
        var locsubstring = data.substring(data.indexOf("Location"), data.indexOf("Desc"));
        var loc = locsubstring.substring(10, locsubstring.indexOf("|"))

        addMarker(loc, data);
        // alert(loc)
      }
    }

    function addMarker(location, popupInfo){
      l = location;
      mapboxClient.geocoding
              .forwardGeocode({
                query: l,
                autocomplete: false,
                limit: 10
              })
              .send()
              .then(function (response) {
                if (
                        response &&
                        response.body &&
                        response.body.features &&
                        response.body.features.length
                ) {
                  var feature = response.body.features[0];

                  // Creates DOM element for the marker
                  function createDOM() {
                    var el = document.createElement('div');
                    el.id = 'marker';
                    return el;
                  }

                  function createPopUp() {
                    // alert(eventsInfo)
                    // var textDisp = "Event Name: " + eventName + "\n | Event Type: " + eventType + "\n | Organization: " + orgName + "\n | Location: " + loc + "\n | Details: " + desc + "\n | Contact: " + contactInfo + "\n | Website URL: " + webLink + "\n | Attendees Needed: " + attendees
                    var popup = new mapboxgl.Popup({offset: 25}).setText(popupInfo);
                    return popup;
                  }

                  new mapboxgl.Marker(createDOM())
                          .setLngLat(feature.center)
                          .setPopup(createPopUp())
                          /* .setPopup(createPopUp(prompt("Insert information about location here: "))) // sets a popup on this marker*/
                          .addTo(map);

                }
              })
    }

    //pass in event info and adds event to firebase
    function addEventToFirebase(type, eventName, orgName, location, desc, contactInfo, url = "", attendeesNeeded = -1) {
      firebase.firestore().ref(type+'events/' + eventName).set({
        name : eventName,
        orgname : orgName,
        location : location,
        desc : desc,
        contactinfo : contactInfo,
        attendees : 0,
        attendeesNeeded : attendeesNeeded,
        url : url
      });
    }

    //eventType should be type of event according to UI, not firebase
    //returns all events.txt in database collection of name eventType + "event"
    function getEventsOfType(eventType) {
      events = []
      firebase.firestore().collection(eventType+"events").get().then(function(querySnapshot) {
        querySnapshot.forEach(function (doc) {
          data = doc.data()
          eventData = [data.name, data.orgname, data.location, data.desc, data.contactinfo, data.attendees, data.attendeesNeeded, data.url]
          events.append(eventData)
        });
      });

      return events;

    }

    // The name parameter is a String that refers to the city, state of the event
    function createEventObject(x){
      if(x == true){
        l = "United States";
        displayMap(true);
      }
      else{
        l = loc;
      }
      /*l = area;*/
    }
    function setInfo() {
      document.getElementById("lbl1").innerHTML+=eventType;
      document.getElementById("lbl2").innerHTML+=eventName;
      document.getElementById("lbl3").innerHTML+=orgName;
      document.getElementById("lbl4").innerHTML+=loc;
      document.getElementById("lbl5").innerHTML+=desc;
      document.getElementById("lbl6").innerHTML+=contactInfo;
      document.getElementById("lbl7").innerHTML+=webLink;
      document.getElementById("lbl8").innerHTML+=attendees;
    }
    // displayMap(true);

    function displayMap(result) {
      //var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });
      mapboxClient.geocoding
              .forwardGeocode({
                query: l,
                autocomplete: false,
                limit: 10
              })
              .send()
              .then(function(response) {
                if (
                        response &&
                        response.body &&
                        response.body.features &&
                        response.body.features.length
                ) {
                  var feature = response.body.features[0];
//                      var map = new mapboxgl.Map({
//                          container: 'map',
//                          style: 'mapbox://styles/nayak1329/ckbkci8ei02ei1ijzqesxvof5',
//                          center: feature.center,
//                          zoom: 2.8
//                      });

                  // Creates DOM element for the marker
                  function createDOM() {
                    var el = document.createElement('div');
                    el.id = 'marker';
                    return el;
                  }

                  // Creates Pop-Up for the marker
                  function createPopUp() {
                    var textDisp = "Event Name: " + eventName + "\n | Event Type: " + eventType + "\n | Organization: " + orgName + "\n | Location: " + loc + "\n | Details: " + desc + "\n | Contact: " + contactInfo + "\n | Website URL: " + webLink + "\n | Attendees Needed: " + attendees
                    var popup = new mapboxgl.Popup({offset: 25}).setText(textDisp);
                    return popup;
                  }


                  if (result == false) {
                    map.centerline = feature.center;
                    new mapboxgl.Marker(createDOM())
                            .setLngLat(feature.center)
                            .setPopup(createPopUp())
                            /* .setPopup(createPopUp(prompt("Insert information about location here: "))) // sets a popup on this marker*/
                            .addTo(map);
                    map.flyTo({
                      center: feature.center,
                      zoom: 14,
                      bearing: 0,
                      speed: .7,
                      curve: 1.5,
                      essential: true
                    })
                  }

                  function setMarkers(type, eventName, orgName, location, desc, contactInfo, url, attendeesNeeded) {
                    new mapboxgl.Marker(createDOM())
                            .setLngLat(feature.center)
                            .setPopup(displayPreviousInfo(type, eventName, orgName, location, desc, contactInfo, url, attendeesNeeded))
                            /* .setPopup(createPopUp(prompt("Insert information about location here: "))) // sets a popup on this marker*/
                            .addTo(map);
                  }

                  // Creates the Pop-Up for all previously created markers
                  function displayPreviousInfo(type, e_Name, orgName, location, desc, contactInfo, url, attendeesNeeded) {
                    var textDisp = "Event Name: " + e_Name + "\n | Event Type: " + type + "\n | Organization: " + orgName + "\n | Location: " + location + "\n | Details: " + desc + "\n | Contact: " + contactInfo + "\n | Website URL: " + url + "\n | Attendees Needed: " + attendeesNeeded
                    var popup = new mapboxgl.Popup({offset: 25}).setText(textDisp);
                    return popup;
                  }
                }
              })
    }

    /*------popup-------*/


  </script>

  <br/>
  <br/>

</main><!-- End #main -->

<!-- ======= Footer ======= --><footer id="footer">
  <div class="container">
    <div class="copyright">
      &copy; Copyright <strong><span>FindMyEvent</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      <!-- All the links in the footer should remain intact. -->
      <!-- You can delete the links only if you purchased the pro version. -->
      <!-- Licensing information: https://bootstrapmade.com/license/ -->
      <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/anyar-free-multipurpose-one-page-bootstrap-theme/ -->
      Developed by Abhi Nayak, Skyler Gao, and Jay Gandhi<br>
      S/O <a href="https://bootstrapmade.com/" style="color: white;">BootstrapMade</a><br><br>
    </div>
  </div>
  </div>
</footer><!-- End Footer -->

<a href="#" class="back-to-top"><i class="ri-arrow-up-line"></i></a>
<div id="preloader"></div>

<!-- Vendor JS Files -->
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
<script src="assets/vendor/venobox/venobox.min.js"></script>
<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="assets/vendor/aos/aos.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>

</body>

</html>